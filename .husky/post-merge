#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ODAVL Post-merge Integration
echo "ğŸ”„ ODAVL Post-merge Integration Running..."

# Check if package.json was updated (dependencies changed)
if $(git diff-tree -r --name-only --no-commit-id HEAD~1 HEAD | grep -q "package.json\|pnpm-lock.yaml"); then
    echo "ğŸ“¦ Dependencies changed, running full setup..."
    pnpm install
fi

# Run ODAVL cycle to assess new code state
echo "ğŸ“Š Running ODAVL post-merge assessment..."
pnpm run odavl:run

# Update forensic analysis with merged changes
echo "ğŸ” Updating forensic analysis..."
pnpm run forensic:setup

echo "âœ… Post-merge integration completed!"