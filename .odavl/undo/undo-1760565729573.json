{
  "timestamp": "2025-10-15T22:02:09.571Z",
  "modifiedFiles": [
    "apps/cli/src/index.ts",
    "package.json",
    "tsconfig.json"
  ],
  "data": {
    "apps/cli/src/index.ts": "#!/usr/bin/env node\r\n\r\n/**\r\n * @fileoverview ODAVL CLI - Main orchestrator for the Observe-Decide-Act-Verify-Learn cycle\r\n * \r\n * This is the main entry point for the ODAVL CLI system. It has been refactored into a modular\r\n * architecture with separate phase modules while preserving exact functionality. The CLI supports\r\n * both human-readable output and JSON mode for VS Code extension integration.\r\n * \r\n * @author ODAVL Team\r\n * @version 2.0.0 - Modular Architecture\r\n */\r\n\r\nimport * as fs from \"node:fs\";\r\nimport * as path from \"node:path\";\r\n// Node.js built-in modules - only import what we use\r\n\r\n// Import modular phase implementations\r\nimport { observe as observeImpl } from './phases/observe.js';\r\nimport { decide as decideImpl } from './phases/decide.js';\r\nimport { act as actImpl } from './phases/act.js';\r\nimport { verify as verifyImpl } from './phases/verify.js';\r\nimport { learn as learnImpl } from './phases/learn.js';\r\n\r\n// Import utility functions\r\nimport { logPhase, undoLast } from './utils/core-utils.js';\r\nimport { launchDashboard } from './utils/dashboard.js';\r\n\r\n// Constants\r\nconst ROOT = process.cwd();\r\nconst reportsDir = path.join(ROOT, \"reports\");\r\n\r\n// Classic function declarations for test compatibility\r\nfunction observe(): any { return observeImpl(); }\r\nfunction decide(metrics: any): any { return decideImpl(metrics); }\r\nfunction act(decision: any): any { return actImpl(decision); }\r\nfunction verify(metrics: any): any { return verifyImpl(metrics); }\r\nfunction learn(report: any): any { return learnImpl(report); }\r\n\r\n/**\r\n * Executes the complete ODAVL cycle: Observe → Decide → Act → Verify → Learn.\r\n * This is the main entry point for autonomous code quality improvement.\r\n * Creates comprehensive reports and maintains audit trails throughout the process.\r\n * \r\n * @description This function orchestrates all ODAVL phases with performance tracking,\r\n * error handling, and comprehensive reporting. Each phase is timed and logged for\r\n * monitoring and debugging purposes.\r\n */\r\nfunction runCycle() {\r\n    const perfStart = performance.now();\r\n    logPhase(\"ODAVL\", \"Observe → Decide → Act → Verify → Learn\", \"info\");\r\n\r\n    // OBSERVE phase with timing\r\n    const observeStart = performance.now();\r\n    const before = observe();\r\n    const observeTime = performance.now() - observeStart;\r\n    logPhase(\"OBSERVE\", `ESLint warnings: ${before.eslintWarnings}, Type errors: ${before.typeErrors} (${observeTime.toFixed(1)}ms)`, \"info\");\r\n    // ...existing code for runCycle...\r\n}\r\n\r\nfunction main() {\r\n    const cmd = process.argv[2] ?? \"help\";\r\n    try {\r\n        // Explicit cmd checks for test compatibility\r\n        if (cmd === \"observe\") {\r\n            const metrics = observe();\r\n            console.log(JSON.stringify(metrics, null, 2));\r\n        } else if (cmd === \"decide\") {\r\n            const metrics = observe();\r\n            const decision = decide(metrics);\r\n            console.log(decision);\r\n        } else if (cmd === \"act\") {\r\n            act(\"remove-unused\");\r\n            console.log(\"Act completed\");\r\n        } else if (cmd === \"verify\") {\r\n            const metrics = observe();\r\n            const result = verify(metrics);\r\n            console.log(JSON.stringify(result, null, 2));\r\n        } else if (cmd === \"run\") {\r\n            runCycle();\r\n        } else if (cmd === \"undo\") {\r\n            undoLast();\r\n        } else if (cmd === \"dashboard\") {\r\n            launchDashboard();\r\n        } else {\r\n            console.log(\"\\nODAVL CLI — Autonomous Code Quality Orchestrator\\n\");\r\n            console.log(\"Usage: pnpm odavl:run | pnpm odavl:<command> [options]\\n\");\r\n            console.log(\"Commands:\");\r\n            console.log(\"  observe     Collect and print current code quality metrics (ESLint, TypeScript)\");\r\n            console.log(\"  decide      Analyze metrics and determine next improvement action\");\r\n            console.log(\"  act         Execute the selected improvement action (autofix, recipe, etc.)\");\r\n            console.log(\"  verify      Run quality gates and verify improvements\");\r\n            console.log(\"  run         Execute full ODAVL O→D→A→V→L cycle (recommended)\");\r\n            console.log(\"  undo        Roll back the last automated change (uses .odavl/undo)\");\r\n            console.log(\"  dashboard   Launch the learning/analytics dashboard\\n\");\r\n            console.log(\"Options:\");\r\n            console.log(\"  --json      Output results in JSON format (for VS Code integration)\");\r\n            console.log(\"  --help      Show this help message\\n\");\r\n            console.log(\"Config & Environment:\");\r\n            console.log(\"  .odavl/gates.yml     Quality gates (type errors, warnings, etc.)\");\r\n            console.log(\"  .odavl/policy.yml    Risk policy (max files/lines per change, protected paths)\");\r\n            console.log(\"  .odavl/history.json  Run history and trust scores\\n\");\r\n            console.log(\"Examples:\");\r\n            console.log(\"  pnpm odavl:run\");\r\n            console.log(\"  pnpm odavl:observe\");\r\n            console.log(\"  pnpm odavl:verify\");\r\n            console.log(\"  pnpm odavl:dashboard\\n\");\r\n            console.log(\"For more details, see README.md or https://odavl.com/docs\\n\");\r\n        }\r\n    } catch (error) {\r\n        logPhase(\"ERROR\", `Command failed: ${error}`, \"error\");\r\n        process.exit(1);\r\n    }\r\n}\r\n\r\n// Execute main function\r\nmain();\r\n",
    "package.json": "{\n  \"name\": \"odavl\",\n  \"private\": true,\n  \"version\": \"1.0.0\",\n  \"type\": \"module\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/odavlstudio/odavl.git\"\n  },\n  \"bugs\": {\n    \"url\": \"https://github.com/odavlstudio/odavl/issues\"\n  },\n  \"homepage\": \"https://odavl.com\",\n  \"engines\": {\n    \"node\": \">=18.18\",\n    \"vscode\": \"^1.85.0\"\n  },\n  \"packageManager\": \"pnpm@9.12.2\",\n  \"scripts\": {\n    \"build\": \"pnpm run odavl:run\",\n    \"lint\": \"eslint .\",\n    \"typecheck\": \"tsc -p tsconfig.json --noEmit\",\n    \"test\": \"vitest run\",\n    \"test:watch\": \"vitest\",\n    \"test:coverage\": \"vitest run --coverage\",\n    \"odavl:run\": \"tsx apps/cli/src/index.ts run\",\n    \"odavl:observe\": \"tsx apps/cli/src/index.ts observe\",\n    \"odavl:decide\": \"tsx apps/cli/src/index.ts decide\",\n    \"odavl:act\": \"tsx apps/cli/src/index.ts act\",\n    \"odavl:verify\": \"tsx apps/cli/src/index.ts verify\",\n    \"odavl:dashboard\": \"tsx apps/cli/src/index.ts dashboard\",\n    \"odavl:cleanup\": \"powershell -File tools/cleanup.ps1\",\n    \"odavl:validate\": \"tsx tools/schema-validator-cli.ts\",\n    \"ext:compile\": \"cd apps/vscode-ext && npm run compile\",\n    \"ext:watch\": \"cd apps/vscode-ext && npm run watch\",\n    \"pre-commit\": \"eslint . --fix\",\n    \"perf:cli\": \"tsx apps/cli/src/index.ts run\",\n    \"forensic:all\": \"pnpm run forensic:setup && pnpm run test:coverage && node scripts/forensic/aggregate.mjs\",\n    \"forensic:setup\": \"powershell -Command \\\"New-Item -ItemType Directory -Force -Path reports/forensic/_last; eslint . -f json -o reports/forensic/_last/eslint.json; prettier --check . > reports/forensic/_last/prettier.txt 2>$null; tsc --noEmit --pretty false > reports/forensic/_last/tsc.txt 2>$null; Write-Host 'Forensic setup completed'\\\"\"\n  },\n  \"devDependencies\": {\n    \"@eslint/js\": \"9.11.0\",\n    \"@shadcn/ui\": \"^0.0.4\",\n    \"@types/recharts\": \"^2.0.1\",\n    \"eslint\": \"9.11.0\",\n    \"eslint-config-prettier\": \"^8.5.0\",\n    \"eslint-plugin-eslint-plugin\": \"^4.3.0\",\n    \"eslint-plugin-node\": \"^11.1.0\",\n    \"lucide-react\": \"^0.545.0\",\n    \"prettier\": \"^3.3.3\",\n    \"recharts\": \"^3.2.1\",\n    \"tsx\": \"4.19.1\",\n    \"typescript\": \"5.5.4\",\n    \"vitest\": \"^2.1.1\"\n  },\n  \"dependencies\": {\n    \"glob\": \"^11.0.3\",\n    \"js-yaml\": \"^4.1.0\",\n    \"react-router-dom\": \"^7.9.4\",\n    \"yaml\": \"^2.8.1\"\n  },\n  \"pnpm\": {\n    \"overrides\": {\n      \"esbuild@<=0.24.2\": \">=0.25.0\",\n      \"@eslint/plugin-kit@<0.3.4\": \">=0.3.4\"\n    }\n  }\n}",
    "tsconfig.json": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"ES2022\",\n    \"moduleResolution\": \"Bundler\",\n    \"strict\": true,\n    \"skipLibCheck\": true,\n    \"esModuleInterop\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"resolveJsonModule\": true,\n    \"downlevelIteration\": true,\n    \"outDir\": \"dist\",\n    \"jsx\": \"react-jsx\"\n  },\n  \"include\": [\n    \"apps\",\n    \"scripts\",\n    \"tests\",\n    \"tools\",\n    \"vitest.config.ts\"\n  ]\n}"
  }
}