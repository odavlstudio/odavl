{
  "timestamp": "2025-10-12T01:21:50.585Z",
  "modifiedFiles": [
    "apps/cli/src/index.ts",
    "package.json",
    "tsconfig.json"
  ],
  "data": {
    "apps/cli/src/index.ts": "#!/usr/bin/env node\r\n\r\n/**\r\n * @fileoverview ODAVL CLI - Main orchestrator for the Observe-Decide-Act-Verify-Learn cycle\r\n * \r\n * This is the main entry point for the ODAVL CLI system. It has been refactored into a modular\r\n * architecture with separate phase modules while preserving exact functionality. The CLI supports\r\n * both human-readable output and JSON mode for VS Code extension integration.\r\n * \r\n * @author ODAVL Team\r\n * @version 2.0.0 - Modular Architecture\r\n */\r\n\r\nimport * as fs from \"node:fs\";\r\nimport * as path from \"node:path\";\r\n// Node.js built-in modules - only import what we use\r\n\r\n// Import modular phase implementations\r\nimport { observe } from './phases/observe.js';\r\nimport { decide } from './phases/decide.js';\r\nimport { act } from './phases/act.js';\r\nimport { verify } from './phases/verify.js';\r\nimport { learn } from './phases/learn.js';\r\n\r\n// Import utility functions\r\nimport { logPhase, undoLast } from './utils/core-utils.js';\r\nimport { launchDashboard } from './utils/dashboard.js';\r\n\r\n// Constants\r\nconst ROOT = process.cwd();\r\nconst reportsDir = path.join(ROOT, \"reports\");\r\n\r\n/**\r\n * Executes the complete ODAVL cycle: Observe → Decide → Act → Verify → Learn.\r\n * This is the main entry point for autonomous code quality improvement.\r\n * Creates comprehensive reports and maintains audit trails throughout the process.\r\n * \r\n * @description This function orchestrates all ODAVL phases with performance tracking,\r\n * error handling, and comprehensive reporting. Each phase is timed and logged for\r\n * monitoring and debugging purposes.\r\n */\r\nfunction runCycle(): void {\r\n  const perfStart = performance.now();\r\n  logPhase(\"ODAVL\", \"Observe → Decide → Act → Verify → Learn\", \"info\");\r\n  \r\n  // OBSERVE phase with timing\r\n  const observeStart = performance.now();\r\n  const before = observe();\r\n  const observeTime = performance.now() - observeStart;\r\n  logPhase(\"OBSERVE\", `ESLint warnings: ${before.eslintWarnings}, Type errors: ${before.typeErrors} (${observeTime.toFixed(1)}ms)`, \"info\");\r\n  \r\n  // DECIDE phase with timing\r\n  const decideStart = performance.now();\r\n  const decision = decide(before);\r\n  const decideTime = performance.now() - decideStart;\r\n  logPhase(\"DECIDE\", `${decision} (${decideTime.toFixed(1)}ms)`, \"info\");\r\n  \r\n  // ACT phase with timing\r\n  const actStart = performance.now();\r\n  act(decision);\r\n  const actTime = performance.now() - actStart;\r\n  logPhase(\"ACT\", `Completed (${actTime.toFixed(1)}ms)`, \"info\");\r\n  \r\n  // VERIFY phase with timing  \r\n  const verifyStart = performance.now();\r\n  const verificationResult = verify(before);\r\n  const verifyTime = performance.now() - verifyStart;\r\n  logPhase(\"VERIFY\", `Gates ${verificationResult.gatesPassed ? \"PASSED\" : \"FAILED\"} (${verifyTime.toFixed(1)}ms)`, verificationResult.gatesPassed ? \"success\" : \"error\");\r\n  \r\n  // LEARN phase with timing\r\n  const learnStart = performance.now();\r\n  const after = observe(); // Get post-action metrics\r\n  const deltas = {\r\n    eslint: after.eslintWarnings - before.eslintWarnings,\r\n    types: after.typeErrors - before.typeErrors\r\n  };\r\n  \r\n  const report = {\r\n    before,\r\n    after,\r\n    deltas,\r\n    decision,\r\n    gatesPassed: verificationResult.gatesPassed,\r\n    gates: verificationResult.gates\r\n  };\r\n  \r\n  learn(report);\r\n  const learnTime = performance.now() - learnStart;\r\n  logPhase(\"LEARN\", `Trust scores updated (${learnTime.toFixed(1)}ms)`, \"info\");\r\n  \r\n  // Performance metrics\r\n  const totalTime = performance.now() - perfStart;\r\n  const perfMetrics = {\r\n    totalTime: Math.round(totalTime),\r\n    phases: {\r\n      observe: Math.round(observeTime),\r\n      decide: Math.round(decideTime),\r\n      act: Math.round(actTime),\r\n      verify: Math.round(verifyTime),\r\n      learn: Math.round(learnTime)\r\n    },\r\n    timestamp: new Date().toISOString()\r\n  };\r\n  \r\n  // Save performance data\r\n  const perfDir = path.join(reportsDir, \"performance\");\r\n  if (!fs.existsSync(perfDir)) fs.mkdirSync(perfDir, { recursive: true });\r\n  const perfFile = path.join(perfDir, \"cli.json\");\r\n  fs.writeFileSync(perfFile, JSON.stringify(perfMetrics, null, 2));\r\n  \r\n  // Save run report\r\n  const runFile = path.join(reportsDir, `run-${Date.now()}.json`);\r\n  fs.writeFileSync(runFile, JSON.stringify(report, null, 2));\r\n  \r\n  const status = verificationResult.gatesPassed ? \"success\" : \"error\";\r\n  logPhase(\"DONE\", `ESLint warnings: ${before.eslintWarnings} → ${after.eslintWarnings} (Δ ${deltas.eslint}) | Type errors: ${before.typeErrors} → ${after.typeErrors} (Δ ${deltas.types}) | Total: ${totalTime.toFixed(1)}ms`, status);\r\n}\r\n\r\n/**\r\n * Main CLI command dispatcher\r\n * \r\n * @description Handles command-line arguments and routes to appropriate functions.\r\n * Supports individual phase execution, full cycle runs, and utility commands.\r\n */\r\nfunction main(): void {\r\n  const cmd = process.argv[2] ?? \"help\";\r\n  \r\n  try {\r\n    switch (cmd) {\r\n      case \"observe\": {\r\n        const metrics = observe();\r\n        console.log(JSON.stringify(metrics, null, 2));\r\n        break;\r\n      }\r\n      case \"decide\": {\r\n        const metrics = observe();\r\n        const decision = decide(metrics);\r\n        console.log(decision);\r\n        break;\r\n      }\r\n      case \"act\": {\r\n        act(\"remove-unused\");\r\n        console.log(\"Act completed\");\r\n        break;\r\n      }\r\n      case \"verify\": {\r\n        const metrics = observe();\r\n        const result = verify(metrics);\r\n        console.log(JSON.stringify(result, null, 2));\r\n        break;\r\n      }\r\n      case \"run\": {\r\n        runCycle();\r\n        break;\r\n      }\r\n      case \"undo\": {\r\n        undoLast();\r\n        break;\r\n      }\r\n      case \"dashboard\": {\r\n        launchDashboard();\r\n        break;\r\n      }\r\n      case \"help\":\r\n      default: {\r\n        console.log(\"Usage: pnpm odavl:run | pnpm odavl:<command> <observe|decide|act|verify|run|undo|dashboard>\");\r\n        console.log(\"\");\r\n        console.log(\"Commands:\");\r\n        console.log(\"  observe    - Collect quality metrics\");\r\n        console.log(\"  decide     - Determine improvement action\");\r\n        console.log(\"  act        - Execute improvement\");\r\n        console.log(\"  verify     - Check quality gates\");\r\n        console.log(\"  run        - Execute full ODAVL cycle\");\r\n        console.log(\"  undo       - Rollback last changes\");\r\n        console.log(\"  dashboard  - Launch analytics dashboard\");\r\n        break;\r\n      }\r\n    }\r\n  } catch (error) {\r\n    logPhase(\"ERROR\", `Command failed: ${error}`, \"error\");\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\n// Execute main function\r\nmain();",
    "package.json": "{\n  \"name\": \"odavl\",\n  \"private\": true,\n  \"version\": \"1.0.0\",\n  \"type\": \"module\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/odavlstudio/odavl.git\"\n  },\n  \"bugs\": {\n    \"url\": \"https://github.com/odavlstudio/odavl/issues\"\n  },\n  \"homepage\": \"https://odavl.com\",\n  \"engines\": {\n    \"node\": \">=18.18\",\n    \"vscode\": \"^1.85.0\"\n  },\n  \"packageManager\": \"pnpm@9.12.2\",\n  \"scripts\": {\n    \"lint\": \"eslint .\",\n    \"typecheck\": \"tsc -p tsconfig.json --noEmit\",\n    \"test\": \"vitest run\",\n    \"test:watch\": \"vitest\",\n    \"test:coverage\": \"vitest run --coverage\",\n    \"odavl:run\": \"tsx apps/cli/src/index.ts run\",\n    \"odavl:observe\": \"tsx apps/cli/src/index.ts observe\",\n    \"odavl:decide\": \"tsx apps/cli/src/index.ts decide\",\n    \"odavl:act\": \"tsx apps/cli/src/index.ts act\",\n    \"odavl:verify\": \"tsx apps/cli/src/index.ts verify\",\n    \"odavl:dashboard\": \"tsx apps/cli/src/index.ts dashboard\",\n    \"odavl:cleanup\": \"powershell -File tools/cleanup.ps1\",\n    \"ext:compile\": \"cd apps/vscode-ext && npm run compile\",\n    \"ext:watch\": \"cd apps/vscode-ext && npm run watch\",\n    \"pre-commit\": \"eslint . --fix\",\n    \"perf:cli\": \"tsx apps/cli/src/index.ts run\",\n    \"forensic:all\": \"pnpm run forensic:setup && pnpm run test:coverage && node scripts/forensic/aggregate.mjs\",\n    \"forensic:setup\": \"powershell -Command \\\"New-Item -ItemType Directory -Force -Path reports/forensic/_last; eslint . -f json -o reports/forensic/_last/eslint.json; prettier --check . > reports/forensic/_last/prettier.txt 2>$null; tsc --noEmit --pretty false > reports/forensic/_last/tsc.txt 2>$null; Write-Host 'Forensic setup completed'\\\"\"\n  },\n  \"devDependencies\": {\n    \"@eslint/js\": \"9.11.0\",\n    \"@types/node\": \"^24.6.2\",\n    \"eslint\": \"9.11.0\",\n    \"prettier\": \"^3.3.3\",\n    \"tsx\": \"4.19.1\",\n    \"typescript\": \"5.5.4\",\n    \"typescript-eslint\": \"8.7.0\",\n    \"vitest\": \"^2.1.1\",\n    \"zod\": \"^4.1.12\"\n  },\n  \"dependencies\": {\n    \"js-yaml\": \"^4.1.0\"\n  },\n  \"pnpm\": {\n    \"overrides\": {\n      \"esbuild@<=0.24.2\": \">=0.25.0\",\n      \"@eslint/plugin-kit@<0.3.4\": \">=0.3.4\"\n    }\n  }\n}",
    "tsconfig.json": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"ES2022\",\n    \"moduleResolution\": \"Bundler\",\n    \"strict\": true,\n    \"skipLibCheck\": true,\n    \"esModuleInterop\": true,\n    \"forceConsistentCasingInFileNames\": true,\n    \"resolveJsonModule\": true,\n    \"downlevelIteration\": true,\n    \"outDir\": \"dist\"\n  },\n  \"include\": [\"apps\", \"scripts\", \"vitest.config.ts\"]\n}\n"
  }
}